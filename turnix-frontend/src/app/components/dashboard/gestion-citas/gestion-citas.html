<div class="gestion-citas-container">
    <h2 class="dashboard-title">Gesti√≥n de Citas</h2>

    <div class="filters">
        <select>
            <option value="">Todos los estados</option>
            <option value="PROGRAMADA">Programada</option>
            <option value="COMPLETADA">Completada</option>
            <option value="CANCELADA">Cancelada</option>
        </select>

        <select>
            <option value="">Todo el staff</option>
            <option *ngFor="let p of staffList" [value]="p.id">
                {{ p.nombre }} {{ p.apellido }}
            </option>
        </select>

        <select>
            <option value="">Todos los servicios</option>
            <option *ngFor="let s of serviciosList" [value]="s.id">
                {{ s.nombreServicio }}
            </option>
        </select>

        <input type="date">
        
        <button class="btn btn-primary" (click)="abrirModalCrear()">+ Crear Nueva Cita</button>
    </div>

    <div class="citas-table">
        <table>
            <thead>
                <tr>
                    <th>CLIENTE</th>
                    <th>SERVICIO</th>
                    <th>STAFF</th>
                    <th>FECHA Y HORA</th>
                    <th>STATUS</th>
                    <th>ACCIONES</th>
                </tr>
            </thead>
            
            <tbody *ngIf="citas.length > 0; else noCitas">
                <tr *ngFor="let cita of citas">
                    <td>
                        <div class="client-info">
                            <strong>{{ cita.cliente.nombre }} {{ cita.cliente.apellido }}</strong>
                            <small>{{ cita.cliente.telefono || 'Sin telf.' }}</small>
                        </div>
                    </td>
                    
                    <td>{{ cita.servicio.nombreServicio }}</td>
                    
                    <td>{{ cita.profesional.nombre }} {{ cita.profesional.apellido }}</td>
                    
                    <td>
                        {{ cita.fechaHoraInicio | date:'dd/MM/yyyy' }} <br>
                        <span style="color: #aaa;">{{ cita.fechaHoraInicio | date:'shortTime' }}</span>
                    </td>
                    
                    <td>
                        <span class="status" [ngClass]="'status-' + cita.estado.toLowerCase()">
                            {{ cita.estado }}
                        </span>
                    </td>
                    
                    <td class="acciones">
                        <button class="btn btn-secondary" (click)="abrirModalEditar(cita)">Editar</button>
                        <button class="btn btn-danger" (click)="eliminarCita(cita)">Quitar</button>
                    </td>
                </tr>
            </tbody>

            <ng-template #noCitas>
                <tbody>
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: #888;">
                            No hay citas registradas para este negocio.
                        </td>
                    </tr>
                </tbody>
            </ng-template>
        </table>
    </div>

    <div class="modal-overlay" *ngIf="mostrarModal">
        <div class="modal-content">
            <h3>{{ modoEdicion ? 'Editar Cita' : 'Nueva Cita' }}</h3>
            
            <form (ngSubmit)="guardarCita()">
                
                <div class="form-group">
                    <label>ID Cliente:</label>
                    <input type="number" [(ngModel)]="citaForm.clienteId" name="clienteId" required placeholder="Ej: 1">
                </div>

                <div class="form-group">
                    <label>Profesional:</label>
                    <select [(ngModel)]="citaForm.profesionalId" name="profesionalId" required>
                        <option value="" disabled>Seleccione...</option>
                        <option *ngFor="let p of staffList" [value]="p.id">
                            {{ p.nombre }} {{ p.apellido }}
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Servicio:</label>
                    <select [(ngModel)]="citaForm.servicioId" name="servicioId" required>
                        <option value="" disabled>Seleccione...</option>
                        <option *ngFor="let s of serviciosList" [value]="s.id">
                            {{ s.nombreServicio }} - {{ s.duracionEstimada }} min
                        </option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Fecha:</label>
                        <input type="date" [(ngModel)]="citaForm.fecha" name="fecha" required>
                    </div>
                    <div class="form-group">
                        <label>Hora:</label>
                        <input type="time" [(ngModel)]="citaForm.hora" name="hora" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Estado:</label>
                        <select [(ngModel)]="citaForm.estado" name="estado">
                            <option value="PROGRAMADA">Programada</option>
                            <option value="COMPLETADA">Completada</option>
                            <option value="CANCELADA">Cancelada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Precio Final:</label>
                        <input type="number" [(ngModel)]="citaForm.precioFinal" name="precioFinal" required>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" (click)="cerrarModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>

            </form>
        </div>
    </div>

</div>